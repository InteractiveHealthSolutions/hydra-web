<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

	<!-- See http://wiki.openmrs.org/display/docs/Module+liquibase+File for 
		documentation on this file. See http://www.liquibase.org/manual/home#available_database_refactorings 
		for a list of supported elements and attributes -->

	<changeSet author="naveed.iqbal" id="hydra-201905091131">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_workflow" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_workflow table
		</comment>
		<createTable tableName="hydramodule_workflow">
			<column name="workflow_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="concept_id" type="int">
			</column>


			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_workflow_creator_fk"
			baseTableName="hydramodule_workflow" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_workflow_changed_by_fk"
			baseTableName="hydramodule_workflow" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_workflow_voided_by_fk"
			baseTableName="hydramodule_workflow" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_workflow_concept_fk"
			baseTableName="hydramodule_workflow" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201905091132">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_phase" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_phase table
		</comment>
		<createTable tableName="hydramodule_phase">
			<column name="phase_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="concept_id" type="int">
			</column>


			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_phase_creator_fk"
			baseTableName="hydramodule_phase" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_phase_changed_by_fk"
			baseTableName="hydramodule_phase" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_phase_voided_by_fk"
			baseTableName="hydramodule_phase" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_phase_concept_fk"
			baseTableName="hydramodule_phase" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201905091133">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_component" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_component table
		</comment>
		<createTable tableName="hydramodule_component">
			<column name="component_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="concept_id" type="int">
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_component_creator_fk"
			baseTableName="hydramodule_component" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_component_changed_by_fk"
			baseTableName="hydramodule_component" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_component_voided_by_fk"
			baseTableName="hydramodule_component" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_component_concept_fk"
			baseTableName="hydramodule_component" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201905091143">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_workflow_phases" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_workflow_phases table
		</comment>
		<createTable tableName="hydramodule_workflow_phases">
			<column name="id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="workflow_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="phase_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_workflow_phase_phase_fk"
			baseTableName="hydramodule_workflow_phases" baseColumnNames="phase_id"
			referencedTableName="hydramodule_phase" referencedColumnNames="phase_id" />
		<addForeignKeyConstraint constraintName="hydramodule_workflow_phase_workflow_fk"
			baseTableName="hydramodule_workflow_phases" baseColumnNames="workflow_id"
			referencedTableName="hydramodule_workflow" referencedColumnNames="workflow_id" />
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201905091243">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_phase_components" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_phase_components table
		</comment>
		<createTable tableName="hydramodule_phase_components">
			<column name="id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="component_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="phase_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_phase_components_component_fk"
			baseTableName="hydramodule_phase_components" baseColumnNames="component_id"
			referencedTableName="hydramodule_component" referencedColumnNames="component_id" />


		<addForeignKeyConstraint constraintName="hydramodule_phase_components_phase_fk"
			baseTableName="hydramodule_phase_components" baseColumnNames="phase_id"
			referencedTableName="hydramodule_phase" referencedColumnNames="phase_id" />

	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201907081343">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_phase_components"
					columnName="display_order" />
			</not>
		</preConditions>
		<comment>
			Adding column 'display_order' in hydramodule_phase_components
			table
		</comment>
		<addColumn tableName="hydramodule_phase_components">
			<column name="workflow_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="display_order" type="int">
				<constraints nullable="false" />
			</column>
		</addColumn>
		<addForeignKeyConstraint constraintName="hydramodule_workflow_phase_component_fk"
			baseTableName="hydramodule_phase_components" baseColumnNames="workflow_id"
			referencedTableName="hydramodule_workflow" referencedColumnNames="workflow_id" />
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201907071343">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_workflow_phases"
					columnName="display_order" />
			</not>
		</preConditions>
		<comment>
			Adding column 'display_order' in hydramodule_workflow_phases
			table
		</comment>
		<addColumn tableName="hydramodule_workflow_phases">
			<column name="display_order" type="int">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="hydra-201905091125" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form table
		</comment>
		<createTable tableName="hydramodule_form">
			<column name="hydramodule_form_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="form_id" type="int">
			</column>
			<column name="form_actions" type="varchar(10000)">
			</column>
			<column name="core" type="BOOLEAN" defaultValueBoolean="false" />
			<column name="component_id" type="int" />

			<column name="encounter_type_id" type="int" />


			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_form_encounter_type_fk"
			baseTableName="hydramodule_form" baseColumnNames="encounter_type_id"
			referencedTableName="encounter_type" referencedColumnNames="encounter_type_id" />
		<addForeignKeyConstraint constraintName="openmrs_form_fk"
			baseTableName="hydramodule_form" baseColumnNames="form_id"
			referencedTableName="form" referencedColumnNames="form_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_component_fk"
			baseTableName="hydramodule_form" baseColumnNames="component_id"
			referencedTableName="hydramodule_component" referencedColumnNames="component_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_creator_fk"
			baseTableName="hydramodule_form" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_changed_by_fk"
			baseTableName="hydramodule_form" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_voided_by_fk"
			baseTableName="hydramodule_form" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-202002011035">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_component_form" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_component_form table
		</comment>
		<createTable tableName="hydramodule_component_form">
			<column name="component_form_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="workflow_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="phase_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="component_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="form_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="display_order" type="int">
			</column>
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_component_form_workflow_fk"
			baseTableName="hydramodule_component_form" baseColumnNames="workflow_id"
			referencedTableName="hydramodule_workflow" referencedColumnNames="workflow_id" />
		<addForeignKeyConstraint constraintName="hydramodule_component_form_phase_fk"
			baseTableName="hydramodule_component_form" baseColumnNames="phase_id"
			referencedTableName="hydramodule_phase" referencedColumnNames="phase_id" />
		<addForeignKeyConstraint constraintName="hydramodule_component_form_component_fk"
			baseTableName="hydramodule_component_form" baseColumnNames="component_id"
			referencedTableName="hydramodule_component" referencedColumnNames="component_id" />
		<addForeignKeyConstraint constraintName="hydramodule_component_form_form_fk"
			baseTableName="hydramodule_component_form" baseColumnNames="form_id"
			referencedTableName="hydramodule_form" referencedColumnNames="hydramodule_form_id" />

	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-201905091130">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form_tag" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form_tag table
		</comment>
		<createTable tableName="hydramodule_form_tag">
			<column name="form_tag_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_form_tag_creator_fk"
			baseTableName="hydramodule_form_tag" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_tag_changed_by_fk"
			baseTableName="hydramodule_form_tag" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_tag_voided_by_fk"
			baseTableName="hydramodule_form_tag" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-201905091141" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form_tag_map" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form_tag_map table
		</comment>
		<createTable tableName="hydramodule_form_tag_map">
			<column name="id" type="int" autoIncrement="true">
				<constraints primaryKey="true" />
			</column>
			<column name="form_tag_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="hydramodule_form_id" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_form_tag_map_form_tag_fk"
			baseTableName="hydramodule_form_tag_map" baseColumnNames="form_tag_id"
			referencedTableName="hydramodule_form_tag" referencedColumnNames="form_tag_id" />

		<addForeignKeyConstraint constraintName="hydramodule_form_tag_map_form_fk"
			baseTableName="hydramodule_form_tag_map" baseColumnNames="hydramodule_form_id"
			referencedTableName="hydramodule_form" referencedColumnNames="hydramodule_form_id" />
	</changeSet>

	<changeSet id="hydra-201905091245" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_asset_category" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_asset_type table
		</comment>
		<createTable tableName="hydramodule_asset_category">
			<column name="asset_category_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_asset_category_creator_fk"
			baseTableName="hydramodule_asset_category" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_category_changed_by_fk"
			baseTableName="hydramodule_asset_category" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_category_voided_by_fk"
			baseTableName="hydramodule_asset_category" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="hydra-201905091201" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_asset_type" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_asset_type table
		</comment>
		<createTable tableName="hydramodule_asset_type">
			<column name="asset_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="asset_category_id" type="int" />

			<column name="description" type="varchar(255)" defaultValue="" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_asset_type_creator_fk"
			baseTableName="hydramodule_asset_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_type_changed_by_fk"
			baseTableName="hydramodule_asset_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_type_voided_by_fk"
			baseTableName="hydramodule_asset_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_type_asset_category_id_fk"
			baseTableName="hydramodule_asset_type" baseColumnNames="asset_category_id"
			referencedTableName="hydramodule_asset_category"
			referencedColumnNames="asset_category_id" />

	</changeSet>

	<changeSet id="hydra-201905091202" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_asset" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_asset table
		</comment>
		<createTable tableName="hydramodule_asset">
			<column name="asset_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="capital_value" type="varchar(8)"></column>
			<column name="reference_id" type="varchar(45)"></column>
			<column name="date_procured" type="datetime"></column>
			<column name="asset_type_id" type="int"></column>

			<column name="fixed_asset" type="BOOLEAN" defaultValueBoolean="true">
				<constraints nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_asset_creator_fk"
			baseTableName="hydramodule_asset" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_changed_by_fk"
			baseTableName="hydramodule_asset" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_voided_by_fk"
			baseTableName="hydramodule_asset" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_asset_asset_type_id_fk"
			baseTableName="hydramodule_asset" baseColumnNames="asset_type_id"
			referencedTableName="hydramodule_asset_type" referencedColumnNames="asset_type_id" />
	</changeSet>

	<changeSet id="hydra-202001011201" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_service_type" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_service_type table
		</comment>
		<createTable tableName="hydramodule_service_type">
			<column name="service_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="encounter_type_id" type="int" />

			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_service_type_encounter_type_fk"
			baseTableName="hydramodule_service_type" baseColumnNames="encounter_type_id"
			referencedTableName="encounter_type" referencedColumnNames="encounter_type_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_type_creator_fk"
			baseTableName="hydramodule_service_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_type_changed_by_fk"
			baseTableName="hydramodule_service_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_type_voided_by_fk"
			baseTableName="hydramodule_service_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202001011245" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_service_category" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_service table
		</comment>
		<createTable tableName="hydramodule_service_category">
			<column name="service_category_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_service_category_creator_fk"
			baseTableName="hydramodule_service_category" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_category_changed_by_fk"
			baseTableName="hydramodule_service_category" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_category_voided_by_fk"
			baseTableName="hydramodule_service_category" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202001011202" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_service" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_service table
		</comment>
		<createTable tableName="hydramodule_service">
			<column name="service_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="unit_cost" type="varchar(8)"></column>
			<column name="reference_id" type="varchar(45)"></column>
			<column name="service_type_id" type="int">
			</column>
			<column name="service_category_id" type="int" />

			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_service_creator_fk"
			baseTableName="hydramodule_service" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_changed_by_fk"
			baseTableName="hydramodule_service" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_voided_by_fk"
			baseTableName="hydramodule_service" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_service_type_id_fk"
			baseTableName="hydramodule_service" baseColumnNames="service_type_id"
			referencedTableName="hydramodule_service_type" referencedColumnNames="service_type_id" />
		<addForeignKeyConstraint constraintName="hydramodule_service_service_category_id_fk"
			baseTableName="hydramodule_service" baseColumnNames="service_category_id"
			referencedTableName="hydramodule_service_category"
			referencedColumnNames="service_category_id" />
	</changeSet>

	<changeSet id="hydra-202010011100" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_participant_salary_type" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_participant_salary_type table
		</comment>
		<createTable tableName="hydramodule_participant_salary_type">
			<column name="salary_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_salary_type_creator_fk"
			baseTableName="hydramodule_participant_salary_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_salary_type_changed_by_fk"
			baseTableName="hydramodule_participant_salary_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_salary_type_voided_by_fk"
			baseTableName="hydramodule_participant_salary_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202010011058" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_participant" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_participant table
		</comment>
		<createTable tableName="hydramodule_participant">
			<column name="participant_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="salary_value" type="varchar(8)"></column>
			<column name="user_id" type="int"></column>
			<column name="salary_type_id" type="int"></column>

			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_participant_creator_fk"
			baseTableName="hydramodule_participant" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_participant_changed_by_fk"
			baseTableName="hydramodule_participant" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_participant_voided_by_fk"
			baseTableName="hydramodule_participant" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />

		<addForeignKeyConstraint constraintName="hydramodule_participant_salary_type_id_fk"
			baseTableName="hydramodule_participant" baseColumnNames="salary_type_id"
			referencedTableName="hydramodule_participant_salary_type"
			referencedColumnNames="salary_type_id" />
		<addForeignKeyConstraint constraintName="hydramodule_participant_user_id_fk"
			baseTableName="hydramodule_participant" baseColumnNames="user_id"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>





	<changeSet id="hydra-201905091203" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_type" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_type table
		</comment>
		<createTable tableName="hydramodule_event_type">
			<column name="event_type_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_event_type_creator_fk"
			baseTableName="hydramodule_event_type" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_type_changed_by_fk"
			baseTableName="hydramodule_event_type" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_type_voided_by_fk"
			baseTableName="hydramodule_event_type" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-201905091204" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_schedule" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_schedule table
		</comment>
		<createTable tableName="hydramodule_event_schedule">
			<column name="schedule_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="planned_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="end_date" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="event_date" type="datetime">
			</column>
			<column name="reason_deferred" type="varchar(255)"></column>
			<column name="description" type="text">
			</column>
			<column defaultValueNumeric="0" name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"></constraints>
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_event_schedule_creator_fk"
			baseTableName="hydramodule_event_schedule" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_schedule_changed_by_fk"
			baseTableName="hydramodule_event_schedule" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_schedule_voided_by_fk"
			baseTableName="hydramodule_event_schedule" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="hydra-201905091205" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event table
		</comment>
		<createTable tableName="hydramodule_event">
			<column name="event_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="name" type="varchar(128)">
				<constraints nullable="false" />
			</column>
			<column name="closure_notes" type="varchar(255)">

			</column>
			<column name="reference_id" type="varchar(128)">
			</column>
			<column name="schedule_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="event_type_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="location_id" type="int">
				<constraints nullable="false" />
			</column>
			<column defaultValueBoolean="false" name="closed" type="boolean">
			</column>
			<column name="description" type="text">
			</column>
			<column defaultValueNumeric="0" name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"></constraints>
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_event_schedule_fk"
			baseTableName="hydramodule_event" baseColumnNames="schedule_id"
			referencedTableName="hydramodule_event_schedule"
			referencedColumnNames="schedule_id" />

		<addForeignKeyConstraint constraintName="hydramodule_event_location_fk"
			baseTableName="hydramodule_event" baseColumnNames="location_id"
			referencedTableName="location" referencedColumnNames="location_id" />

		<addForeignKeyConstraint constraintName="hydramodule_event_event_type_fk"
			baseTableName="hydramodule_event" baseColumnNames="event_type_id"
			referencedTableName="hydramodule_event_type" referencedColumnNames="event_type_id" />

		<addForeignKeyConstraint constraintName="hydramodule_event_creator_fk"
			baseTableName="hydramodule_event" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_changed_by_fk"
			baseTableName="hydramodule_event" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_voided_by_fk"
			baseTableName="hydramodule_event" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="hydra-201905091206" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_asset" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_asset table
		</comment>
		<createTable tableName="hydramodule_event_asset">
			<column name="event_asset_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="event_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="asset_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="quantity" type="int">
			</column>
			<column name="actual_cost" type="text">
			</column>
			<column name="planned_for_event" type="int" />
			<column name="available_in_event" type="int" />
			<column name="description" type="text">
			</column>
			<column defaultValueNumeric="0" name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"></constraints>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_event_asset_event_fk"
			baseTableName="hydramodule_event_asset" baseColumnNames="event_id"
			referencedTableName="hydramodule_event" referencedColumnNames="event_id" />

		<addForeignKeyConstraint constraintName="hydramodule_event_assest_asset_fk"
			baseTableName="hydramodule_event_asset" baseColumnNames="asset_id"
			referencedTableName="hydramodule_asset" referencedColumnNames="asset_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_asset_creator_fk"
			baseTableName="hydramodule_event_asset" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_asset_changed_by_fk"
			baseTableName="hydramodule_event_asset" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_asset_voided_by_fk"
			baseTableName="hydramodule_event_asset" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202014010337" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_service" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_asset table
		</comment>
		<createTable tableName="hydramodule_event_service">
			<column name="event_service_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="event_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="service_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="quantity" type="int">
			</column>
			<column name="actual_cost" type="text">
			</column>
			<column name="planned_for_event" type="int" />
			<column name="available_in_event" type="int" />
			<column name="description" type="text">
			</column>
			<column defaultValueNumeric="0" name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"></constraints>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_event_service_event_fk"
			baseTableName="hydramodule_event_service" baseColumnNames="event_id"
			referencedTableName="hydramodule_event" referencedColumnNames="event_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_service_service_fk"
			baseTableName="hydramodule_event_service" baseColumnNames="service_id"
			referencedTableName="hydramodule_service" referencedColumnNames="service_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_service_creator_fk"
			baseTableName="hydramodule_event_service" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_service_changed_by_fk"
			baseTableName="hydramodule_event_service" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_service_voided_by_fk"
			baseTableName="hydramodule_event_service" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202014010346" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_participants" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_asset table
		</comment>
		<createTable tableName="hydramodule_event_participants">
			<column name="event_participant_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="event_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="participant_id" type="int">
				<constraints nullable="false" />
			</column>
			<column name="planned_for_event" type="boolean">
			</column>
			<column name="attendance" type="boolean">
			</column>
			<column name="absence_reason" type="varchar(255)"
				defaultValue="null" />

			<column name="description" type="text">
			</column>
			<column defaultValueNumeric="0" name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"></constraints>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_event_participants_event_fk"
			baseTableName="hydramodule_event_participants" baseColumnNames="event_id"
			referencedTableName="hydramodule_event" referencedColumnNames="event_id" />
		<addForeignKeyConstraint
			constraintName="hydramodule_event_participants_participant_fk"
			baseTableName="hydramodule_event_participants" baseColumnNames="participant_id"
			referencedTableName="hydramodule_participant" referencedColumnNames="participant_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_participants_creator_fk"
			baseTableName="hydramodule_event_participants" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint
			constraintName="hydramodule_event_participants_changed_by_fk"
			baseTableName="hydramodule_event_participants" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_event_participants_voided_by_fk"
			baseTableName="hydramodule_event_participants" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202002021309" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_field" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_field table
		</comment>
		<createTable tableName="hydramodule_field">
			<column name="field_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="field_type_id" type="int" />
			<column name="concept_id" type="int" />

			<column name="select_multiple" type="BOOLEAN" />

			<column name="table_name" type="varchar(255)" />
			<column name="attribute_name" type="varchar(255)" />
			<column name="default_value" type="varchar(100)" />

			<column name="name" type="varchar(255)">
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_field_field_type_fk"
			baseTableName="hydramodule_field" baseColumnNames="field_type_id"
			referencedTableName="field_type" referencedColumnNames="field_type_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_concept_fk"
			baseTableName="hydramodule_field" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_creator_fk"
			baseTableName="hydramodule_field" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_changed_by_fk"
			baseTableName="hydramodule_field" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_voided_by_fk"
			baseTableName="hydramodule_field" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>

	<changeSet id="hydra-202002021322" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_field_answer" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_field_answer table
		</comment>
		<createTable tableName="hydramodule_field_answer">
			<column name="field_answer_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="field_id" type="int" />
			<column name="concept_id" type="int" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_field_answer_field_fk"
			baseTableName="hydramodule_field_answer" baseColumnNames="field_id"
			referencedTableName="hydramodule_field" referencedColumnNames="field_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_answer_concept_fk"
			baseTableName="hydramodule_field_answer" baseColumnNames="concept_id"
			referencedTableName="concept" referencedColumnNames="concept_id" />
	</changeSet>

	<changeSet id="hydra-202001300654" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form_field" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form_field table
		</comment>
		<createTable tableName="hydramodule_form_field">
			<column name="form_field_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="display_order" type="int" />
			<column name="min_occurrence" type="int" />
			<column name="max_occurrence" type="int" />
			<column name="min_value" type="int" />
			<column name="max_value" type="int" />
			<column name="min_length" type="int" />
			<column name="max_length" type="int" />
			<column name="min_selections" type="int" />

			<column name="allow_future_date" type="BOOLEAN" />
			<column name="allow_past_date" type="BOOLEAN" />
			<column name="mandatory" type="BOOLEAN" />
			<column name="scoreable" type="BOOLEAN" />
			<column name="allow_decimal" type="BOOLEAN" />

			<column name="default_value" type="varchar(255)" />
			<column name="error_message" type="varchar(255)" />
			<column name="regix" type="varchar(100)" />
			<column name="characters" type="varchar(255)" />
			<column name="display_text" type="varchar(255)" />

			<column name="form_id" type="int" />
			<column name="field_id" type="int" />

			<column name="name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_form_field_form_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="form_id"
			referencedTableName="hydramodule_form" referencedColumnNames="hydramodule_form_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_field_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="field_id"
			referencedTableName="hydramodule_field" referencedColumnNames="field_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_creator_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_changed_by_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_voided_by_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="hydra-202002040850" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_field_rule" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_field_rule table
		</comment>
		<createTable tableName="hydramodule_field_rule">
			<column name="rule_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="form_id" type="int" />
			<column name="target_form_id" type="int" />
			<column name="target_field_id" type="int" />

			<column name="action_name" type="varchar(255)" />

			<!-- <column name="form_id" type="int" /> <column name="field_id" type="int" 
				/> -->

			<column name="name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_form_field_form_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="form_id"
			referencedTableName="hydramodule_form" referencedColumnNames="hydramodule_form_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_target_form_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="target_form_id"
			referencedTableName="hydramodule_form" referencedColumnNames="hydramodule_form_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_field_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="target_field_id"
			referencedTableName="hydramodule_field" referencedColumnNames="field_id" />


		<addForeignKeyConstraint constraintName="hydramodule_field_rule_creator_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_rule_changed_by_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_rule_voided_by_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	<changeSet id="hydra-202002040911" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_rule_token" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_rule_token table
		</comment>
		<createTable tableName="hydramodule_rule_token">
			<column name="token_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="type_name" type="varchar(255)">
			</column>
			<column name="value" type="varchar(255)">
			</column>
			<column name="rule_id" type="int" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_rule_token_rule_fk"
			baseTableName="hydramodule_rule_token" baseColumnNames="rule_id"
			referencedTableName="hydramodule_field_rule" referencedColumnNames="rule_id" />

	</changeSet>

	<changeSet id="hydra-202002051230" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form_encounter" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form_encounter table
		</comment>
		<createTable tableName="hydramodule_form_encounter">
			<column name="form_encounter_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="component_form_id" type="int" />
			<column name="encounter_id" type="int" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint
			constraintName="hydramodule_form_encounter_component_form_fk"
			baseTableName="hydramodule_form_encounter" baseColumnNames="component_form_id"
			referencedTableName="hydramodule_component_form"
			referencedColumnNames="component_form_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_encounter_encounter_fk"
			baseTableName="hydramodule_form_encounter" baseColumnNames="encounter_id"
			referencedTableName="encounter" referencedColumnNames="encounter_id" />

	</changeSet>

	<changeSet id="hydra-202002050653" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_encounter" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_encounter table
		</comment>
		<createTable tableName="hydramodule_event_encounter">
			<column name="event_encounter_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="event_id" type="int" />
			<column name="encounter_id" type="int" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_event_encounter_event_fk"
			baseTableName="hydramodule_event_encounter" baseColumnNames="event_id"
			referencedTableName="hydramodule_event" referencedColumnNames="event_id" />

		<addForeignKeyConstraint constraintName="hydramodule_event_encounter_encounter_fk"
			baseTableName="hydramodule_event_encounter" baseColumnNames="encounter_id"
			referencedTableName="encounter" referencedColumnNames="encounter_id" />

	</changeSet>

	<changeSet id="hydra-202002060954" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_event_summary" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_event_summary table
		</comment>
		<createTable tableName="hydramodule_event_summary">
			<column name="event_summary_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="event_id" type="int" />
			<column name="total_screen" type="int" />
			<column name="total_presumptive" type="int" />
			<column name="sample_collected" type="int" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_event_summary_event_fk"
			baseTableName="hydramodule_event_summary" baseColumnNames="event_id"
			referencedTableName="hydramodule_event" referencedColumnNames="event_id" />

	</changeSet>

	<changeSet id="hydra-202003013257" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_patient_workflow" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_patient_workflow table
		</comment>
		<createTable tableName="hydramodule_patient_workflow">
			<column name="patient_workflow_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="workflow_id" type="int" />
			<column name="patient_id" type="int" />
			<column name="description" type="text">
			</column>
			<column defaultValueNumeric="0" name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints nullable="false" unique="true"></constraints>
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_patient_workflow_workflow_fk"
			baseTableName="hydramodule_patient_workflow" baseColumnNames="patient_id"
			referencedTableName="patient" referencedColumnNames="patient_id" />

		<addForeignKeyConstraint constraintName="hydramodule_patient_workflow_patient_fk"
			baseTableName="hydramodule_patient_workflow" baseColumnNames="workflow_id"
			referencedTableName="hydramodule_workflow" referencedColumnNames="workflow_id" />

		<addForeignKeyConstraint constraintName="hydramodule_patient_workflow_creator_fk"
			baseTableName="hydramodule_patient_workflow" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_patient_workflow_changed_by_fk"
			baseTableName="hydramodule_patient_workflow" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_patient_workflow_voided_by_fk"
			baseTableName="hydramodule_patient_workflow" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />

	</changeSet>
	
	<changeSet id="hydra-202003192128" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form_field_group" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form_field_group table
		</comment>
		<createTable tableName="hydramodule_form_field_group">
			<column name="group_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" />
			</column>
			<column name="group_name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="uuid" type="char(38)">
				<constraints nullable="false" />
			</column>
		</createTable>
	</changeSet>
	<changeSet id="hydra-202003311111" author="hareem.ajaz">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_user_workflow" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_user_workflow table
		</comment>
		<createTable tableName="hydramodule_user_workflow">
			<column name="user_workflow_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="workflow_id" type="int" />
			<column name="user_id" type="int" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
		    <column name="voided_by" type="int" />
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />	<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_user_workflow_workflow_fk"
			baseTableName="hydramodule_user_workflow" baseColumnNames="user_id"
			referencedTableName="users" referencedColumnNames="user_id" />

		<addForeignKeyConstraint constraintName="hydramodule_user_workflow_user_fk"
			baseTableName="hydramodule_user_workflow" baseColumnNames="workflow_id"
			referencedTableName="hydramodule_workflow" referencedColumnNames="workflow_id" />

		<addForeignKeyConstraint constraintName="hydramodule_user_workflow_creator_fk"
			baseTableName="hydramodule_user_workflow" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_user_workflow_changed_by_fk"
			baseTableName="hydramodule_user_workflow" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_user_workflow_voided_by_fk"
			baseTableName="hydramodule_user_workflow" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />

	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-202003192129">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_form_field" columnName="score_field" />
			</not>
		</preConditions>
		<comment>
			Adding new columns in hydramodule_form_field table
		</comment>
		<addColumn tableName="hydramodule_form_field">
			<column name="score_field" type="BOOLEAN" />
			<column name="create_patient" type="BOOLEAN" />
			<column name="group_id" type="int" />
			<column name="parent_id" type="int"/>
		</addColumn>
		<addForeignKeyConstraint constraintName="hydramodule_form_field_group_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="group_id"
			referencedTableName="hydramodule_form_field_group" referencedColumnNames="group_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_parent_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="form_field_id"
			referencedTableName="hydramodule_form_field" referencedColumnNames="parent_id" />
	
	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-202003271056">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_field_rule" columnName="target_field_answer_id" />
			</not>                       
		</preConditions>
		<comment>
			Adding new columns in hydramodule_field_rule table
		</comment>
		<addColumn tableName="hydramodule_field_rule">
			<column name="target_field_answer_id" type="int" />
			<column name="target_form_field_id" type="int" />
		</addColumn>
		<addForeignKeyConstraint constraintName="hydramodule_field_rule_target_field_answer_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="target_field_answer_id"
			referencedTableName="hydramodule_field_answer" referencedColumnNames="field_answer_id" />
		<addForeignKeyConstraint constraintName="hydramodule_field_rule_target_form_field_fk"
			baseTableName="hydramodule_field_rule" baseColumnNames="target_form_field_id"
			referencedTableName="hydramodule_from_field" referencedColumnNames="form_field_id" />
	
	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-202004030931">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_form_field" columnName="disabled" />
			</not>                       
		</preConditions>
		<comment>
			Adding new columns in hydramodule_form_field table
		</comment>
		<addColumn tableName="hydramodule_form_field">
			<column name="disabled" type="BOOLEAN" />
		</addColumn>
	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-202004150848">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_component_form" columnName="retired" />
			</not>                       
		</preConditions>
		<comment>
			Adding new columns in hydramodule_component_form table
		</comment>
		<addColumn tableName="hydramodule_component_form">
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
		</addColumn>
		<addForeignKeyConstraint constraintName="hydramodule_component_form_retired_by_fk"
			baseTableName="hydramodule_component_form" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet>
	
	
	
	<!-- <changeSet id="hydra-202003190151" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_field_type_config_item" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_field_type_config_item table
		</comment>
		<createTable tableName="hydramodule_field_type_config_item">
			<column name="config_item_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" />
			</column>
			<column name="item_name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="field_type_id" type="int">
				<constraints nullable="false" />
			</column>
		</createTable>

		<addForeignKeyConstraint constraintName="hydramodule_field_type_config_item_fk"
			baseTableName="hydramodule_field_type_config_item" baseColumnNames="field_type_id"
			referencedTableName="field_type" referencedColumnNames="form_type_id" />
	</changeSet>
	
	<changeSet id="hydra-202003190219" author="naveed.iqbal">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_form_field_config_value" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_form_field_config_value table
		</comment>
		<createTable tableName="hydramodule_form_field_config_value">
			<column name="config_value_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="min_value" type="int" />
			<column name="max_value" type="int" />
			<column name="min_length" type="int" />
			<column name="max_length" type="int" />
			<column name="min_selections" type="int" />

			<column name="allow_future_date" type="BOOLEAN" />
			<column name="allow_past_date" type="BOOLEAN" />
			<column name="mandatory" type="BOOLEAN" />
			<column name="allow_decimal" type="BOOLEAN" />

			<column name="error_message" type="varchar(255)" />
			<column name="regix" type="varchar(100)" />
			<column name="characters" type="varchar(255)" />
			<column name="display_text" type="varchar(255)"></column>
			
			<column name="config_item_id" type="int" />
			
			<column name="form_field_id" type="int" />

			<column name="name" type="varchar(255)">
				<constraints nullable="false" />
			</column>
			<column name="description" type="varchar(255)" defaultValue="null" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="retired" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
			<column name="retired_by" type="int" />
			<column name="date_retired" type="datetime" />
			<column name="retire_reason" type="varchar(255)" defaultValue="null" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_form_field_form_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="form_id"
			referencedTableName="hydramodule_form" referencedColumnNames="hydramodule_form_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_field_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="field_id"
			referencedTableName="hydramodule_field" referencedColumnNames="field_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_creator_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_changed_by_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_form_field_voided_by_fk"
			baseTableName="hydramodule_form_field" baseColumnNames="retired_by"
			referencedTableName="users" referencedColumnNames="user_id" />
	</changeSet> -->








<changeSet author="rabbia.hassan" id="createFunction-alphanum">
	    <createProcedure>
	    	CREATE FUNCTION `alphanum`( str VARCHAR(255) ) RETURNS varchar(255) CHARSET latin1
			    DETERMINISTIC
			BEGIN 
			  DECLARE i, len SMALLINT DEFAULT 1; 
			  DECLARE ret CHAR(255) DEFAULT ''; 
			  DECLARE c CHAR(1);
			  IF str IS NOT NULL THEN 
			    SET len = CHAR_LENGTH( str ); 
			    REPEAT 
			      BEGIN 
			        SET c = MID( str, i, 1 ); 
			        IF c REGEXP '[[:alnum:]]' THEN 
			          SET ret=CONCAT(ret,c); 
			        END IF; 
			        SET i = i + 1; 
			      END; 
			    UNTIL i > len END REPEAT; 
			  ELSE
			    SET ret='';
			  END IF;
			  RETURN ret; 
			END
	    </createProcedure>
	    </changeSet>
	    
	    <changeSet author="rabbia.hassan" id="createProcedure-deencounterised">
	    <createProcedure>
		CREATE PROCEDURE `deencountrised`(IN datefrom datetime, IN dateto datetime, IN workflow varchar(50), IN prefix varchar(50))
		
		BEGIN			
			DECLARE n,i,enc_n,enc_i,obs_n,obs_i INT DEFAULT 0;
			DECLARE tab_name,concept_name,colName, wf VARCHAR(60);
			DECLARE enc_type_id,pid,lid,eid,c,c_id, prov_id INT;
			DECLARE edt,dc datetime;
			DECLARE datatype VARCHAR(20);
			DECLARE v_numeric double;
			DECLARE v_coded INT;
			DECLARE v_text,v_datetime, v_tex, concept_answer, workflow_filter TEXT;
			
			/** For every encounter_type **/
			SELECT COUNT(*) FROM encounter_type where retired = 0 INTO n;
			SET i=0;
			WHILE i &lt; n DO 
			
				/** name for de-encounterised table **/
				SELECT CONCAT('enc_',alphanum(LOWER(encounter_type.name)),'_',prefix), encounter_type_id  into tab_name,enc_type_id FROM encounter_type where retired = 0 LIMIT i,1; 
				
				/** drop de-encountrised table **/
				SET @drop_table:=CONCAT('DROP TABLE IF EXISTS ', tab_name);
				PREPARE stmt from @drop_table;
				EXECUTE stmt;
				
				/** create de-encountrised table with metadata from encounter table **/
				SET @create_table:=CONCAT('CREATE TABLE ',tab_name,' (id INT NOT NULL AUTO_INCREMENT, encounter_id INT NOT NULL, patient_id INT NOT NULL, location_id INT NOT NULL, provider_id INT, creator INT NOT NULL, encounter_datetime DATETIME NOT NULL, date_created DATETIME NOT NULL, workflow varchar(50), PRIMARY KEY (id))');
				PREPARE stmt from @create_table;
				EXECUTE stmt;
				
				/** For all the encounters of the specific encounter_type **/
                if workflow = ''  then
                
					SELECT count(*) from encounter 
					left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id
					left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id
					left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id
					left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id
					where encounter_type = enc_type_id and encounter.voided = 0 
					and encounter.encounter_datetime between datefrom and dateto
					INTO enc_n;
                
                else
                
					SELECT count(*) from encounter 
					left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id
					left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id
					left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id
					left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id
					where encounter_type = enc_type_id and encounter.voided = 0 
					and hydramodule_workflow.name = workflow and encounter.encounter_datetime between datefrom and dateto
					INTO enc_n;
                
                end if;
		        
				SET enc_i=0;
				WHILE enc_i &lt; enc_n DO 
				    
                    if workflow = ''  then
                    
						SELECT encounter.encounter_id into eid from encounter
						left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id 
						left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id 
						left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id 
						left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id 
						where encounter_type = enc_type_id and encounter.voided = 0
						and encounter.encounter_datetime between datefrom and dateto
						LIMIT enc_i, 1;
                    
                    else
                    
						SELECT encounter.encounter_id into eid from encounter
						left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id 
						left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id 
						left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id 
						left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id 
						where encounter_type = enc_type_id and encounter.voided = 0
						and hydramodule_workflow.name =  workflow and encounter.encounter_datetime between datefrom and dateto
						LIMIT enc_i, 1;
                    
                    end if;
		            
					/** Get encounter metadata info and insert into de-encountrised table **/
					SET @insert_query:=CONCAT('INSERT INTO ',tab_name,' (patient_id, location_id, encounter_id, encounter_datetime, date_created, creator, provider_id, workflow) ',
												'SELECT encounter.patient_id, encounter.location_id, encounter.encounter_id, encounter.encounter_datetime, encounter.date_created, ',
												'encounter.creator, encounter_provider.provider_id, hydramodule_workflow.name from encounter ', 
												'left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id ',
												'left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id ',
												'left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id ',
												'left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id ',
												'where encounter.encounter_id = ', eid);
		            PREPARE stmt from @insert_query;
					EXECUTE stmt;
			
					/** For all the obs of the specific encounter **/
					SELECT count(*) from obs where encounter_id = eid and voided = 0 into obs_n;
					SET obs_i=0;
					
                    WHILE obs_i &lt; obs_n DO 
						
						/** Get concept_id (question) and answers from value columns **/
						SELECT concept_id, value_numeric, value_coded, value_text, value_datetime into c_id, v_numeric, v_coded, v_text, v_datetime from obs where encounter_id = eid and voided = 0 LIMIT obs_i,1;
						/** generate column name **/
						SELECT alphanum(LOWER(name)) FROM concept_name where concept_id = c_id and concept_name_type = 'SHORT' limit 1 into concept_name;
			
						/** Check if concept column already exists in the de-encountrised table **/
						SET colName = NULL;
						SELECT column_name INTO colName
						FROM information_schema.columns 
						WHERE table_schema = 'hydra'
							AND table_name = tab_name
						AND column_name = concept_name;
									
						/** Get question datatype **/            
						SELECT concept_datatype.name into datatype from concept 
						join concept_datatype on concept.datatype_id = concept_datatype.concept_datatype_id
						where concept_id = c_id;
															
						/** alter to add column to de-encounterised table  and insert data according to datatype **/
						CASE datatype
							
							WHEN 'Coded' THEN 
                            
                                IF v_coded is not null then
					
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' text');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
													
								/** Get concept name for the coded_value **/
								SELECT name FROM concept_name where concept_id = v_coded and concept_name_type = 'FULLY_SPECIFIED' limit 1 into concept_answer;
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = IF(',concept_name,' is NULL,''', concept_answer, ''', CONCAT(' , concept_name,  ', '', '' ''', concept_answer,''')) WHERE encounter_id = ' , eid);
                                PREPARE stmt from @insert_value;
								EXECUTE stmt;
                                
                                end if;
                                
                            WHEN 'Numeric' THEN
							
								IF v_numeric is not null then
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' double');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
								                                
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = ',  v_numeric ,' WHERE encounter_id = ' , eid);
								PREPARE stmt from @insert_value;
								EXECUTE stmt; 
                                end if;
														
                            WHEN 'Text' THEN 
								
                                IF v_text is not null then
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' text');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
							
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = IF(',concept_name,' is NULL,''', v_text, ''', CONCAT(' , concept_name,  ', '', '' ''', v_text,''')) WHERE encounter_id = ' , eid);
								PREPARE stmt from @insert_value;
								EXECUTE stmt;
								END IF;
                                
							WHEN 'Date' || 'Time' || 'Datetime' THEN 
							
								IF v_datetime is not null then
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' datetime');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
							
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = ''',  v_datetime ,''' WHERE encounter_id = ' , eid);
								PREPARE stmt from @insert_value;
								EXECUTE stmt;
                                end if;
								
						END CASE;
									
						SET obs_i = obs_i + 1;
					END WHILE;
							
					SET enc_i = enc_i + 1;
				END WHILE;
			
				SET i = i + 1;
			END WHILE;
			
		END;
	    
	    </createProcedure>
	</changeSet>
	
	<changeSet author="rabbia.hassan" id="createProcedure-norm-patient">
	    <createProcedure>
		CREATE PROCEDURE `norm_patient`(IN datefrom datetime, IN dateto datetime, IN workflow varchar(50), IN prefix varchar(50))
		
		BEGIN
		            
			DECLARE n,i,idn_i,idn_n,attr_i,attr_n INT DEFAULT 0;
		    DECLARE pid INT;
		    DECLARE idn_type, idn, loc, colName, loc_colName, attr_type, attr_value, format varchar(50);
		    DECLARE location_value, concept_value, workflow_filter TEXT;
            DECLARE tab_name varchar(50);
            
            SET tab_name = CONCAT('normpatient', '_' , prefix);
            
            SET @drop_qurey:=CONCAT('DROP TABLE IF EXISTS ', tab_name);
			PREPARE stmt from @drop_qurey;
			EXECUTE stmt;
            
            SET @create_qurey:=CONCAT('CREATE TABLE ',tab_name,' (id int(11) NOT NULL AUTO_INCREMENT,patient_id int(11) NOT NULL,workflow varchar(50),gender varchar(50),birthdate date,given_name varchar(50),family_name varchar(50),date_created datetime,creator int(11) NOT NULL,PRIMARY KEY (id));');
		    PREPARE stmt from @create_qurey;
			EXECUTE stmt;
            
            if workflow = ''  then
				SET workflow_filter = ' 1=1 ';
            else
				SET workflow_filter =  CONCAT(' hydramodule_workflow.name = ''',workflow,'''');
			end if;
            
            SET @insert_qurey:=CONCAT('Insert into ', tab_name ,' (patient_id,workflow,gender,birthdate,given_name,family_name,date_created,creator)
		    select patient.patient_id, hydramodule_workflow.name, person.gender, person.birthdate, person_name.given_name, person_name.family_name, 
			patient.date_created, patient.creator from patient
			left join person_name on patient.patient_id = person_name.person_id
			left join person on patient.patient_id = person.person_id
			left join hydramodule_patient_workflow on patient.patient_id = hydramodule_patient_workflow.patient_id
			left join hydramodule_workflow on hydramodule_patient_workflow.workflow_id = hydramodule_workflow.workflow_id
			where patient.voided = 0 and ', workflow_filter ,' and patient.date_created between ''',datefrom,''' and ''',dateto,''';');
            PREPARE stmt from @insert_qurey;
			EXECUTE stmt;
            
            if workflow = ''  then
            
            select count(*) from patient
			left join person_name on patient.patient_id = person_name.person_id
			left join person on patient.patient_id = person.person_id
			left join hydramodule_patient_workflow on patient.patient_id = hydramodule_patient_workflow.patient_id
			left join hydramodule_workflow on hydramodule_patient_workflow.workflow_id = hydramodule_workflow.workflow_id
			where patient.voided = 0 and patient.date_created between datefrom and dateto
            into n;
            
            else
            
            select count(*) from patient
			left join person_name on patient.patient_id = person_name.person_id
			left join person on patient.patient_id = person.person_id
			left join hydramodule_patient_workflow on patient.patient_id = hydramodule_patient_workflow.patient_id
			left join hydramodule_workflow on hydramodule_patient_workflow.workflow_id = hydramodule_workflow.workflow_id
			where patient.voided = 0 and hydramodule_workflow.name = workflow and patient.date_created between datefrom and dateto
            into n;
            
            end if;
            
            SET i=0;
			WHILE i &lt; n DO 
		    
				select person.person_id into pid from patient
				left join person_name on patient.patient_id = person_name.person_id
				left join person on patient.patient_id = person.person_id
				left join hydramodule_patient_workflow on patient.patient_id = hydramodule_patient_workflow.patient_id
				left join hydramodule_workflow on hydramodule_patient_workflow.workflow_id = hydramodule_workflow.workflow_id
				where patient.voided = 0 and hydramodule_workflow.name = workflow and patient.date_created between datefrom and dateto
				limit i,1;
                
                select count(*) from patient_identifier where patient_id = pid into idn_n;
		
				SET idn_i=0;
				WHILE idn_i &lt; idn_n DO
		        
					select alphanum(LOWER(patient_identifier_type.name)), identifier, location.name into idn_type, idn, loc from patient_identifier
					left join patient_identifier_type on patient_identifier.identifier_type = patient_identifier_type.patient_identifier_type_id
					left join location on patient_identifier.location_id = location.location_id
		            where patient_id = pid limit idn_i,1;
                    
                    SET loc_colName = CONCAT(idn_type, '_location');
		            
		            SET colName = NULL;
					SELECT column_name INTO colName
					FROM information_schema.columns 
					WHERE table_schema = 'hydra'
						AND table_name = tab_name
					AND column_name = idn_type;
		            
		            IF colName is null THEN 
						SET @alter_query:=CONCAT('ALTER TABLE ', tab_name ,' ADD (', idn_type , ' varchar(50), ', loc_colName, ' varchar(50))');
						PREPARE stmt from @alter_query;
						EXECUTE stmt;
					END IF;
		            
                    if loc is NULL then SET loc = "";
                    end if;
                    
		            SET @update_identifier_query:=CONCAT('update ', tab_name ,' set ', idn_type , ' = ''', idn , ''', ', loc_colName, ' = ''', loc , ''' where patient_id = ' , pid);
		            PREPARE stmt from @update_identifier_query;
					EXECUTE stmt;
		        
					SET idn_i = idn_i + 1;
				END WHILE;
                
                select count(*) from person_attribute where person_id = pid into attr_n;
		
				SET attr_i=0;
				WHILE attr_i &lt; attr_n DO 
		        
					select alphanum(LOWER(name)), value, format into attr_type, attr_value, format from person_attribute
					left join person_attribute_type on person_attribute.person_attribute_type_id = person_attribute_type.person_attribute_type_id
		            where person_id = pid limit attr_i,1;
		        
		            SET colName = NULL;
					SELECT column_name INTO colName
					FROM information_schema.columns 
					WHERE table_schema = 'hydra'
						AND table_name = tab_name
					AND column_name = attr_type;
		            
		            IF colName is null THEN 
						SET @alter_query:=CONCAT('ALTER TABLE ', tab_name ,' ADD ', attr_type , ' varchar(50)');
						PREPARE stmt from @alter_query;
						EXECUTE stmt;
					END IF;
		            
		            CASE format
		            
						WHEN 'java.openmrs.Concept' THEN
		                
							SELECT name FROM concept_name where concept_id = attr_value and concept_name_type = 'FULLY_SPECIFIED' limit 1 into concept_value;
		
							SET @update_attribute_query:=CONCAT('update ', tab_name ,' set ', attr_type , ' = ''', concept_value , ''' where patient_id = ' , pid);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		                    
		                WHEN 'java.openmrs.Location' THEN
		                
							SELECT name FROM location where location_id = attr_value limit 1 into location_value;
		
							SET @update_attribute_query:=CONCAT('update ', tab_name ,' set ', attr_type , ' = ''', location_value , ''' where patient_id = ' , pid);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		                
		                ELSE
		                
							SET @update_attribute_query:=CONCAT('update ', tab_name ,' set ', attr_type , ' = ''', attr_value , ''' where patient_id = ' , pid);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		            
		            END CASE;
		            
					SET attr_i = attr_i + 1;
				END WHILE;
                
                SET i = i + 1;
            END WHILE;
            
            
		END;
				
	    </createProcedure>
	</changeSet>   
	
	<changeSet author="rabbia.hassan" id="createProcedure-norm-provider">
	    <createProcedure>
	    
	    CREATE PROCEDURE `norm_provider`(IN datefrom datetime, IN dateto datetime, IN prefix varchar(50))
		
		BEGIN
		
			DECLARE n,i,attr_i,attr_n INT DEFAULT 0;
		    DECLARE pid INT;
			DECLARE attr_type, attr_value, format, colName varchar(50);
		    DECLARE location_value, concept_value TEXT;
            DECLARE tab_name, roles varchar(50);
		
			SET tab_name = CONCAT('normprovider', '_' , prefix);
             
			SET @drop_qurey:=CONCAT('DROP TABLE IF EXISTS ', tab_name);
			PREPARE stmt from @drop_qurey;
			EXECUTE stmt;
            
            SET @create_qurey:=CONCAT('CREATE TABLE ', tab_name , ' (id int(11) NOT NULL AUTO_INCREMENT, provider_id int(11) NOT NULL, person_id int(11) NOT NULL, name varchar(255), identifier varchar(255) NOT NULL, creator int(11) NOT NULL, gender varchar(50), given_name varchar(50), family_name varchar(50), username varchar(50), assigned_roles varchar(255), PRIMARY KEY (id));' );
            PREPARE stmt from @create_qurey;
			EXECUTE stmt;
            
            SET @insert_qurey:=CONCAT('Insert into ', tab_name ,' (person_id, provider_id, name,identifier,creator,username,given_name,family_name,gender)
		   select provider.person_id, provider.provider_id, provider.name, provider.identifier, provider.creator, users.username, person_name.given_name,
			person_name.family_name, gender from provider
			left join users on users.system_id = provider.identifier
			left join person_name on provider.person_id = person_name.person_id
			left join person on provider.person_id = person.person_id
			where provider.retired = 0 and provider.date_created between ''',datefrom,''' and ''',dateto,''';');
            PREPARE stmt from @insert_qurey;
			EXECUTE stmt;
            
            select count(*) from provider
			left join users on users.system_id = provider.identifier
			left join person_name on provider.person_id = person_name.person_id
			left join person on provider.person_id = person.person_id
			where provider.retired = 0 and provider.date_created between datefrom and dateto
            INTO n;
            
            SET i=0;
			WHILE i &lt; n DO
            
				select person.person_id into pid from provider
				left join users on users.system_id = provider.identifier
				left join person_name on provider.person_id = person_name.person_id
				left join person on provider.person_id = person.person_id
				where provider.retired = 0 and provider.date_created between datefrom and dateto
                limit i,1;
                
                select GROUP_CONCAT(role SEPARATOR ', ') into roles from person 
                left join users on person.person_id = users.person_id
                left join user_role on users.user_id = user_role.user_id
                where person.person_id = pid;
                           
                 if roles is not null then          
					SET @update_role_query:=CONCAT('update ',tab_name,' set assigned_roles = ''', roles , ''' where person_id = ' , pid);
					PREPARE stmt from @update_role_query;
					EXECUTE stmt;
                end if;
                
                SELECT COUNT(*) FROM person_attribute where person_id = pid INTO attr_n;
				SET attr_i=0;
				WHILE attr_i &lt; attr_n DO 
                
					select alphanum(LOWER(name)), value, format into attr_type, attr_value, format from person_attribute
					left join person_attribute_type on person_attribute.person_attribute_type_id = person_attribute_type.person_attribute_type_id
		            where person_id = pid limit attr_i,1;
		            
		            SET colName = NULL;
					SELECT column_name INTO colName
					FROM information_schema.columns 
					WHERE table_schema = 'hydra'
						AND table_name = tab_name
					AND column_name = attr_type;
		            
		            IF colName is null THEN 
						SET @alter_query:=CONCAT('ALTER TABLE ', tab_name ,' ADD ', attr_type , ' varchar(50)');
						PREPARE stmt from @alter_query;
						EXECUTE stmt;
					END IF;
		            
		            CASE format
		            
						WHEN 'java.openmrs.Concept' THEN
		                
							SELECT name FROM concept_name where concept_id = attr_value and concept_name_type = 'FULLY_SPECIFIED' limit 1 into concept_value;
		
							SET @update_attribute_query:=CONCAT('update ',tab_name,' set ', attr_type , ' = ''', concept_value , ''' where person_id = ' , pid);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		                    
		                WHEN 'java.openmrs.Location' THEN
		                
							SELECT name FROM location where location_id = attr_value limit 1 into location_value;
		
							SET @update_attribute_query:=CONCAT('update ',tab_name,' set ', attr_type , ' = ''', location_value , ''' where person_id = ' , pid);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		                
		                ELSE
		                
							SET @update_attribute_query:=CONCAT('update ',tab_name,' set ', attr_type , ' = ''', attr_value , ''' where person_id = ' , pid);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		            
		            END CASE;
                
					SET attr_i = attr_i + 1;
				END WHILE;
            
				SET i = i + 1;
			END WHILE;
			
		END;
	    
	    </createProcedure>
	</changeSet>
	
	<changeSet author="rabbia.hassan" id="createProcedure-norm-location">
	    <createProcedure>
	    
	    CREATE PROCEDURE `norm_location`(IN datefrom datetime, IN dateto datetime, IN prefix varchar(50))
		
		BEGIN
		
			DECLARE n,i,loc_n,loc_i INT DEFAULT 0;
			DECLARE loc_id int;
		    DECLARE attr_type, attr_value, format, colName varchar(50);
		    DECLARE location_value, concept_value TEXT;
            DECLARE tab_name, tags varchar(50);
		
			SET tab_name = CONCAT('normlocation', '_' , prefix);
             
			SET @drop_qurey:=CONCAT('DROP TABLE IF EXISTS ', tab_name);
			PREPARE stmt from @drop_qurey;
			EXECUTE stmt;
            
            SET @create_qurey:=CONCAT('CREATE TABLE ', tab_name , ' (id int(11) NOT NULL AUTO_INCREMENT,location_id int(11) NOT NULL,name varchar(255) NOT NULL, description varchar(255) DEFAULT NULL, associated_tags varchar(255) DEFAULT NULL,address1 varchar(255) DEFAULT NULL, address2 varchar(255) DEFAULT NULL, city_village varchar(255) DEFAULT NULL, state_province varchar(255) DEFAULT NULL,postal_code varchar(50) DEFAULT NULL,country varchar(50) DEFAULT NULL,latitude varchar(50) DEFAULT NULL, longitude varchar(50) DEFAULT NULL, creator int(11) NOT NULL,date_created datetime NOT NULL,county_district varchar(255) DEFAULT NULL,address3 varchar(255) DEFAULT NULL,address4 varchar(255) DEFAULT NULL,address5 varchar(255) DEFAULT NULL,address6 varchar(255) DEFAULT NULL, parent_location int(11) DEFAULT NULL,address7 varchar(255) DEFAULT NULL,address8 varchar(255) DEFAULT NULL,address9 varchar(255) DEFAULT NULL,address10 varchar(255) DEFAULT NULL,address11 varchar(255) DEFAULT NULL,address12 varchar(255) DEFAULT NULL, address13 varchar(255) DEFAULT NULL,address14 varchar(255) DEFAULT NULL,address15 varchar(255) DEFAULT NULL,PRIMARY KEY (id));' );
            PREPARE stmt from @create_qurey;
			EXECUTE stmt;
            
		  SET @insert_qurey:=CONCAT('Insert into ', tab_name ,' (location_id,name,description,address1,address2,city_village,state_province,postal_code,country,latitude,longitude,
		   creator,date_created,county_district,address3,address4,address5,address6,parent_location,address7,address8,address9,
		   address10,address11,address12,address13, address14, address15)
		   select 
		   location_id,name,description,address1,address2,city_village,state_province,postal_code,country,latitude,longitude,
		   creator,date_created,county_district,address3,address4,address5,address6,parent_location,address7,address8,address9,
		   address10,address11,address12,address13, address14, address15
		   from location
		   where location.retired = 0 and location.date_created between ''',datefrom,''' and ''',dateto,''';');
            PREPARE stmt from @insert_qurey;
			EXECUTE stmt;
            
		   select count(*)
		   from location
		   where location.retired = 0 and location.date_created between datefrom and dateto into  n;
           
            SET i=0;
			WHILE i&lt;n DO
                            
                 select location_id into loc_id
				   from location
				   where location.retired = 0 and location.date_created between datefrom and dateto limit i,1;

				select GROUP_CONCAT(location_tag.name SEPARATOR ', ') into tags from location 
                 left join location_tag_map on location.location_id = location_tag_map.location_id
				 left join location_tag on location_tag_map.location_tag_id = location_tag.location_tag_id
                 where location.location_id = loc_id;
                 
                 if tags is not null then
					 SET @update_tag_query:=CONCAT('update ',tab_name,' set associated_tags = ''', tags , ''' where location_id = ' , loc_id);
					PREPARE stmt from @update_tag_query;
					EXECUTE stmt;
                end if;
                
                SELECT COUNT(*) FROM location_attribute where location_id = loc_id INTO loc_n;
				SET loc_i=0;
				WHILE loc_i&lt;loc_n DO 
				
					select alphanum(LOWER(name)), value, format into attr_type, attr_value, format from location_attribute
					left join location_attribute_type on location_attribute.attribute_type_id = location_attribute_type.location_attribute_type_id
		            where location_id = loc_id limit loc_i,1;
		            
		            SET colName = NULL;
					SELECT column_name INTO colName
					FROM information_schema.columns 
					WHERE table_schema = 'hydra'
						AND table_name = 'norm_location'
					AND column_name = attr_type;
		            
		            IF colName is null THEN 
						SET @alter_query:=CONCAT('ALTER TABLE norm_location ADD ', attr_type , ' varchar(50)');
						PREPARE stmt from @alter_query;
						EXECUTE stmt;
					END IF;
		            
		            CASE format
		            
						WHEN 'java.openmrs.Concept' THEN
		                
							SELECT name FROM concept_name where concept_id = attr_value and concept_name_type = 'FULLY_SPECIFIED' limit 1 into concept_value;
		
							SET @update_attribute_query:=CONCAT('update norm_location set ', attr_type , ' = ''', concept_value , ''' where location_id = ' , loc_id);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		                    
		                WHEN 'java.openmrs.Location' THEN
		                
							SELECT name FROM location where location_id = attr_value limit 1 into location_value;
		
							SET @update_attribute_query:=CONCAT('update norm_location set ', attr_type , ' = ''', location_value , ''' where location_id = ' , loc_id);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		                
		                ELSE
		                
							SET @update_attribute_query:=CONCAT('update norm_location set ', attr_type , ' = ''', attr_value , ''' where location_id = ' , loc_id);
							PREPARE stmt from @update_attribute_query;
							EXECUTE stmt;
		            
		            END CASE;
		            
					SET loc_i = loc_i + 1;
				END WHILE;
            
				SET i = i + 1;
			END WHILE;
		
		END;
	    
	    </createProcedure>
	</changeSet>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	<changeSet author="naveed.iqbal" id="hydra-metadata-202003110215">  
	    <comment>insert queries for hydra privileges</comment>
	    <sql
			splitStatements="true"
			stripComments="true">         
		        INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('Access Administration','HYDRA - To allow a user to access admin panel','b7b42859-f21f-4fa9-afca-ffc8a6de9147');
				INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('Manage Events','HYDRA - To allow a user to manage events','5b3fd4e7-0d2c-43bd-95c9-bed5c3c9c089');
				INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('Manage Events Metadata','HYDRA - To allow a user to manage events metadata','28fc5f1b-0fc4-48e4-8101-20652192e0e1');
				INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('Manage Workflows','HYDRA - TO allow a user to manage workflows','d1ff06c3-263e-412f-86ff-41830ddc2e88');
				INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('Manage Workflows Metadata','HYDRA - To allow a user to manage workflows metadata','474917b2-aa0a-4424-9e1c-ba307b042488');
				INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('View Dashboard','HYDRA - To allow a user to view dashboard','98dd1940-c04a-4019-be0e-227246a969ad');
				INSERT IGNORE INTO hydra.`privilege` (`privilege`,`description`,`uuid`) VALUES ('View Reports','HYDRA - To allow a user to view reports','cdc1c789-b7b5-11e6-bc7b-08002765b69c');
	    </sql>    
	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-metadata-20200321145">  
	    <comment>insert queries for concepts related to contact tracing widget</comment>
	    <sql
			splitStatements="true"
			stripComments="true">         
		       	INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168079,0,NULL,NULL,NULL,8,7,0,1,'2020-03-20 08:47:53',NULL,1,'2020-03-20 08:47:53',NULL,NULL,NULL,'d3d9e77a-cb7c-431a-9457-bcc0e4ac9a91');
				INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168080,0,NULL,NULL,NULL,3,7,0,1,'2020-03-20 08:49:19',NULL,1,'2020-03-20 08:49:19',NULL,NULL,NULL,'75a17321-fd69-47be-831e-cd773dc9c3cc');
				INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168081,0,NULL,NULL,NULL,3,7,0,1,'2020-03-20 08:51:12',NULL,1,'2020-03-20 08:51:12',NULL,NULL,NULL,'85fc8b27-8a08-4bdc-bf91-e34af50265aa');
				INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168082,0,NULL,NULL,NULL,3,7,0,1,'2020-03-20 08:51:53',NULL,1,'2020-03-20 08:51:53',NULL,NULL,NULL,'82c65f7c-b9e8-4775-a8bd-f7ad55ab8bf0');
				INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168083,0,NULL,NULL,NULL,3,7,0,1,'2020-03-20 08:52:23',NULL,1,'2020-03-20 08:52:23',NULL,NULL,NULL,'a24d649b-fb89-4b8c-beeb-aacf2872cf22');
				INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168084,0,NULL,NULL,NULL,3,7,0,1,'2020-03-20 09:17:00',NULL,1,'2020-03-20 09:17:00',NULL,NULL,NULL,'7579f93d-ebe7-423f-822b-dbe792248499');
				INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168078,0,NULL,NULL,NULL,3,7,0,1,'2020-03-20 09:17:00',NULL,1,'2020-03-20 09:17:00',NULL,NULL,NULL,'9757f93d-ebe7-423f-822b-dbe792248488');
				
				
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168079,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 08:47:53',NULL,NULL,'42ced4dd-56b6-4379-904a-4b11e96a52de');
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168080,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 08:49:19',NULL,NULL,'6701f093-671a-47ab-bfaf-8b3ac4dc019d');
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168081,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 08:51:12',NULL,NULL,'e69e3e5d-eb99-4c72-bf6f-df37e8db33fe');
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168082,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 08:51:53',NULL,NULL,'24a1bc4f-648a-4328-95fc-c6ec6d596895');
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168083,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 08:52:23',NULL,NULL,'aef45797-2569-4179-914e-ecf518c3ee0d');
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168084,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 09:17:00',NULL,NULL,'5f53232b-a32c-48bd-9d78-b87d97627573');
				INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168078,'Concept used by Hydra Contact Tracing Widget','en',1,'2020-03-20 09:17:00',NULL,NULL,'5f53232b-a32c-48bd-9d78-a32c97627573');
				
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168079,'CONTACT TRACING - CONTACT BIRTHDATE','en',1,'2020-03-20 08:47:53',0,NULL,NULL,NULL,'d614878c-e02f-4e1d-8d3e-3a918f182097','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168079,'Contact Birthdate','en',1,'2020-03-20 08:47:53',0,NULL,NULL,NULL,'cd3b56b6-9c39-4dbc-a200-e606a647d557','SHORT',0,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168080,'CONTACT TRACING - CONTACT GENDER','en',1,'2020-03-20 08:49:19',0,NULL,NULL,NULL,'2f86f4c3-1458-4735-936c-2f4a3bd7c7c5','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168080,'Contact Gender','en',1,'2020-03-20 08:49:19',0,NULL,NULL,NULL,'910b87eb-e1ad-4424-8d54-80eef1c9b854','SHORT',0,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168081,'CONTACT TRACING - CONTACT GIVEN NAME','en',1,'2020-03-20 08:51:12',0,NULL,NULL,NULL,'1d500744-248b-40df-b97e-ee2819551744','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168081,'Contact Given Name','en',1,'2020-03-20 08:51:12',0,NULL,NULL,NULL,'20f66150-6799-42d7-a263-b975bede3b4e','SHORT',0,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168082,'Contact Family Name','en',1,'2020-03-20 08:51:53',0,NULL,NULL,NULL,'dac2334f-ee1b-43c7-aeed-9b37701902f3','SHORT',0,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168082,'CONTACT TRACING - CONTACT FAMILY NAME','en',1,'2020-03-20 08:51:53',0,NULL,NULL,NULL,'2e5251de-470b-4374-bcf5-3c7acf5f9d6f','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168083,'CONTACT TRACING - CONTACT IDENTIFIER','en',1,'2020-03-20 08:52:23',0,NULL,NULL,NULL,'62a174c9-e8a0-40bb-b702-3a646340885e','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168083,'Contact Identifier','en',1,'2020-03-20 08:52:23',0,NULL,NULL,NULL,'c216463f-5847-4f1f-941d-719bd4321c15','SHORT',0,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168084,'CONTACT TRACING - CONTACT RELATIONSHIP','en',1,'2020-03-20 09:17:00',0,NULL,NULL,NULL,'518b3170-d5f0-43b9-8bae-1e38d5f4e420','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168084,'Contact Relationship','en',1,'2020-03-20 09:17:00',0,NULL,NULL,NULL,'5e7cc9ce-18a4-4e93-a20b-d0ffac2c2a22','SHORT',0,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168078,'CONTACT TRACING - CONTACT INFORMATION','en',1,'2020-03-20 09:17:00',0,NULL,NULL,NULL,'518b8bae-d5f0-43b9-8bae-1e38d5f4e420','FULLY_SPECIFIED',1,NULL,NULL);
				INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168078,'Contact Information','en',1,'2020-03-20 09:17:00',0,NULL,NULL,NULL,'5e7cc9ce-18a4-4e93-c2c2-d0ffac2c2a22','SHORT',0,NULL,NULL);
	
	    </sql>    
	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-metadata-202003211041">  
	    <comment>insert queries for hydramodule_field_type metadata</comment>
	    <sql
			splitStatements="true"
			stripComments="true">         
		       	INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (1,'Concept','',0,1,'2005-02-22 00:00:00','8d5e7d7c-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (2,'Database element','',0,1,'2005-02-22 00:00:00','8d5e8196-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (3,'Set of Concepts','',1,1,'2005-02-22 00:00:00','8d5e836c-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (4,'Miscellaneous Set','',1,1,'2005-02-22 00:00:00','8d5e852e-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (5,'Section','',1,1,'2005-02-22 00:00:00','8d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (6,'Textbox',NULL,0,1,'2005-02-22 00:00:00','7d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (7,'Single Select Dropdown',NULL,0,1,'2005-02-22 00:00:00','6d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (8,'Single Select Radiobuttons',NULL,0,1,'2005-02-22 00:00:00','5d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (9,'Multiple Choice',NULL,0,1,'2005-02-22 00:00:00','4d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (10,'Date/ Time Picker',NULL,0,1,'2005-02-22 00:00:00','3d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (11,'Address',NULL,0,1,'2005-02-22 00:00:00','2d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (12,'Heading',NULL,0,1,'2005-02-22 00:00:00','1d5e86fa-c2cc-11de-8d13-0010c6dffd0f');
				INSERT IGNORE INTO hydra.`field_type` (`field_type_id`,`name`,`description`,`is_set`,`creator`,`date_created`,`uuid`) VALUES (13,'Contact Tracing',NULL,0,1,'2005-02-22 00:00:00','0d5eaf67-c2cc-11de-0d13-0010c6dffd0f');
	    </sql>    
	</changeSet>
	
	<changeSet author="naveed.iqbal" id="hydra-metadata-202003211034">  
	    <comment>insert queries for hydramodule_field metadata</comment>
	    <sql
			splitStatements="true"
			stripComments="true">         
		        INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (11,NULL,NULL,NULL,'Address',NULL,'Address','Default field required by Hydra',1,'2020-01-31 13:55:58',NULL,NULL,0,NULL,NULL,NULL,'97c5dc2b-a352-4847-b7f6-c0717e9b3dc7');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (12,NULL,NULL,NULL,'Heading',NULL,'Heading','Default field required by Hydra',1,'2020-01-31 13:55:58',NULL,NULL,0,NULL,NULL,NULL,'4e1640ca-d264-4f8f-9210-66c535053393');  
	    		INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (NULL,168079,NULL,NULL,'Numeric',NULL,'Contact Age','Default field required by Hydra',1,'2020-03-20 09:06:33',NULL,NULL,0,NULL,NULL,NULL,'73e557b7-0be7-4e96-b1f2-11c39534ec29');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (NULL,168080,NULL,NULL,'Text',NULL,'Contact Gender','Default field required by Hydra',1,'2020-03-20 09:06:33',NULL,NULL,0,NULL,NULL,NULL,'73eb7357-7eb0-4e96-b1f2-11c39534ec29');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (NULL,168081,NULL,NULL,'Text',NULL,'Contact Given Name','Default field required by Hydra',1,'2020-03-20 09:06:33',NULL,NULL,0,NULL,NULL,NULL,'73e557b7-7eb0-4e96-2f1b-11c39534ec29');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (NULL,168082,NULL,NULL,'Text',NULL,'Contact Family Name','Default field required by Hydra',1,'2020-03-20 09:06:33',NULL,NULL,0,NULL,NULL,NULL,'73e557b7-7eb0-4e96-b1f2-11c39534e92c');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (NULL,168083,NULL,NULL,'Text',NULL,'Contact Identifier','Default field required by Hydra',1,'2020-03-20 09:06:33',NULL,NULL,0,NULL,NULL,NULL,'37e557b7-7eb0-4e96-b1f2-11c395ec4329');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (NULL,168084,NULL,NULL,'Text',NULL,'Contact Relationship','Default field required by Hydra',1,'2020-03-20 09:06:33',NULL,NULL,0,NULL,NULL,NULL,'37e557b7-0be7-4e96-b1f2-11c395ec4329');
				INSERT IGNORE INTO hydra.`hydramodule_field` (`field_type_id`,`concept_id`,`select_multiple`,`table_name`,`attribute_name`,`default_value`,`name`,`description`,`creator`,`date_created`,`changed_by`,`date_changed`,`retired`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (13,1474,NULL,NULL,'Contact Tracing',NULL,'Contact Tracing','Default field required by Hydra',1,'2020-03-21 10:14:58',NULL,NULL,0,NULL,NULL,NULL,'1e4640ca-d264-4f8f-9210-66c053553933');
	    </sql>    
	</changeSet>

	<changeSet author="naveed.iqbal" id="hydra-metadata-202003242340">  
	    <comment>insert queries for relationship_type missing metadata</comment>
	    <sql
			splitStatements="true"
			stripComments="true">   
				INSERT IGNORE INTO hydra.relationship_type (a_is_to_b,b_is_to_a,preferred,weight,description,creator,date_created,retired,retired_by,date_retired,retire_reason,uuid,date_changed,changed_by) VALUES ('Child','Parent',0,0,'Relationship from a child to the parent',1,'2020-03-24 21:58:31.0',0,NULL,NULL,NULL,'701eebed-edfc-d6d4-a8a5-512c67179ef0',NULL,NULL);
				INSERT IGNORE INTO hydra.relationship_type (a_is_to_b,b_is_to_a,preferred,weight,description,creator,date_created,retired,retired_by,date_retired,retire_reason,uuid,date_changed,changed_by) VALUES ('Spouse','Spouse',0,0,'Relationship between husband/wife or wife/husband',1,'2020-03-24 23:11:31.0',0,NULL,NULL,NULL,'451ebffd-edfc-d6d4-a8a5-512c67179ef0',NULL,NULL);
		</sql>    
	</changeSet>
	<changeSet author="hareem.ajaz" id="20201504111">
		<preConditions onFail="MARK_RAN">
			<sqlCheck expectedResult="0">
				SELECT COUNT(*) FROM scheduler_task_config
				WHERE schedulable_class = 'org.openmrs.module.hydra.web.scheduler.tasks.QXRDataFetchScheduler'
				And name = 'QXR Data Fetch Task'
			</sqlCheck>
		</preConditions>
		<comment>Inserting QXR Data Fetch Task into 'schedule_task_config' table</comment>
		<insert tableName="scheduler_task_config">
			<column name="name" value="QXR Data Fetch Task" />
			<column name="description" value="Periodically fetch data from qxr api" />
			<column name="schedulable_class" value="org.openmrs.module.hydra.web.scheduler.tasks.QXRDataFetchScheduler" />
			<column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss" />
			<column name="start_time" valueDate="2020-04-15T03:20:00" />
			<column name="repeat_interval" value="900" />
			<column name="date_created" valueDate="CURRENT_TIMESTAMP" />
			<column name="created_by" value="1" />
			<column name="uuid" value="8c20b376-1v2b-11f1-a51v-00249140a5ev" />
			<column name="start_on_startup" value="1" />
			<column name="started" value="1" />
		</insert>
		
	</changeSet> 
	<changeSet id="hydra-2020041911111" author="hareem.ajaz">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="hydramodule_encounter_mapper" />
			</not>
		</preConditions>
		<comment>
			Creating the hydramodule_encounter_mapper table
		</comment>
		<createTable tableName="hydramodule_encounter_mapper">
			<column name="encounter_mapper_id" type="int" autoIncrement="true">
				<constraints primaryKey="true" nullable="false" />
			</column>

			<column name="order_encounter_id" type="int" />
			<column name="result_encounter_id" type="int" />
			<column name="creator" type="int">
				<constraints nullable="false" />
			</column>
			<column name="date_created" type="datetime">
				<constraints nullable="false" />
			</column>
			<column name="changed_by" type="int" />
			<column name="date_changed" type="datetime" />
			<column name="voided_by" type="int" />
			<column defaultValueBoolean="false" name="voided" type="boolean">
				<constraints nullable="false" />
			</column>
			<column name="date_voided" type="datetime" />
			<column name="void_reason" type="varchar(255)" />
			<column name="uuid" type="char(38)">
				<constraints unique="true" />
			</column>
		</createTable>
		<addForeignKeyConstraint constraintName="hydramodule_encounter_mapper_order_fk"
			baseTableName="hydramodule_encounter_mapper" baseColumnNames="order_encounter_id"
			referencedTableName="encounter" referencedColumnNames="encounter_id" />

		<addForeignKeyConstraint constraintName="hydramodule_encounter_mapper_result_fk"
			baseTableName="hydramodule_encounter_mapper" baseColumnNames="result_encounter_id"
			referencedTableName="encounter" referencedColumnNames="encounter_id" />

		<addForeignKeyConstraint constraintName="hydramodule_encounter_mapper_creator_fk"
			baseTableName="hydramodule_encounter_mapper" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_encounter_mapper_changed_by_fk"
			baseTableName="hydramodule_encounter_mapper" baseColumnNames="changed_by"
			referencedTableName="users" referencedColumnNames="user_id" />
		<addForeignKeyConstraint constraintName="hydramodule_encounter_mapper_voided_by_fk"
		baseTableName="hydramodule_encounter_mapper" baseColumnNames="voided_by"
			referencedTableName="users" referencedColumnNames="user_id" />

	</changeSet>
	<changeSet author="hareem.ajaz" id="hydra-metadata-202004211035">  
	    <comment>insert queries for concept</comment>
	    <sql
			splitStatements="true"
			stripComments="true">         
		       INSERT IGNORE INTO `concept` (`concept_id`,`retired`,`short_name`,`description`,`form_text`,`datatype_id`,`class_id`,`is_set`,`creator`,`date_created`,`version`,`changed_by`,`date_changed`,`retired_by`,`date_retired`,`retire_reason`,`uuid`) VALUES (168077,0,NULL,NULL,NULL,2,7,0,1,'2020-04-21 12:35:53',NULL,1,'2020-04-21 12:35:53',NULL,NULL,NULL,'d3d9j77a-cg7c-431n-9957-bcc0e4ac9a92');
		       INSERT IGNORE INTO `concept_description` (`concept_id`,`description`,`locale`,`creator`,`date_created`,`changed_by`,`date_changed`,`uuid`) VALUES (168077,'Concept used by hydra for Xray Result Form','en',1,'2020-0-2 08:47:53',NULL,NULL,'42cvd4de-58b6-4979-904b-4b12e99a52dw');
		       INSERT IGNORE INTO `concept_name` (`concept_id`,`name`,`locale`,`creator`,`date_created`,`voided`,`voided_by`,`date_voided`,`void_reason`,`uuid`,`concept_name_type`,`locale_preferred`,`date_changed`,`changed_by`) VALUES (168077,'XRAY COVID RESULT','en',1,'2020-04-21 08:47:53',0,NULL,NULL,NULL,'d714898u-e08g-4w1d-8c3A-3b918g182q97','FULLY_SPECIFIED',1,NULL,NULL);

	    </sql>    
	</changeSet>
	
	<changeSet author="rabbia.hassan" id="hydra-deencounterised-fix">  
		 <comment>Remove procedure</comment>
	    <sql
			splitStatements="true"
			stripComments="true"> 
			DROP procedure IF EXISTS `deencountrised`;        
	    </sql>    
	</changeSet>
	
	<changeSet author="rabbia.hassan" id="deencounterised-identifier-coloumn-added">
	    <createProcedure>
		CREATE PROCEDURE `deencountrised`(IN datefrom datetime, IN dateto datetime, IN workflow varchar(50),  IN prefix varchar(50))
BEGIN			
			DECLARE n,i,enc_n,enc_i,obs_n,obs_i INT DEFAULT 0;
			DECLARE tab_name,concept_name,colName, wf VARCHAR(60);
			DECLARE enc_type_id,pid,lid,eid,c,c_id, prov_id INT;
			DECLARE edt,dc datetime;
			DECLARE datatype VARCHAR(20);
			DECLARE v_numeric double;
			DECLARE v_coded INT;
			DECLARE v_text,v_datetime, v_tex, concept_answer, workflow_filter TEXT;
			
			/** For every encounter_type **/
			SELECT COUNT(*) FROM encounter_type where retired = 0 INTO n;
			SET i=0;
			WHILE i &lt; n DO 
			
				/** name for de-encounterised table **/
				SELECT CONCAT('enc_',alphanum(LOWER(encounter_type.name)),'_',prefix), encounter_type_id  into tab_name,enc_type_id FROM encounter_type where retired = 0 LIMIT i,1; 
				
				/** drop de-encountrised table **/
				SET @drop_table:=CONCAT('DROP TABLE IF EXISTS ', tab_name);
				PREPARE stmt from @drop_table;
				EXECUTE stmt;
				
				/** create de-encountrised table with metadata from encounter table **/
				SET @create_table:=CONCAT('CREATE TABLE ',tab_name,' (id INT NOT NULL AUTO_INCREMENT, encounter_id INT NOT NULL, patient_id INT NOT NULL, patient_identifier TEXT NOT NULL, location_id INT NOT NULL, provider_id INT, creator INT NOT NULL, encounter_datetime DATETIME NOT NULL, date_created DATETIME NOT NULL, workflow varchar(50), PRIMARY KEY (id))');
				PREPARE stmt from @create_table;
				EXECUTE stmt;
				
				/** For all the encounters of the specific encounter_type **/
                if workflow = ''  then
                
					SELECT count(*) from encounter 
					left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id
					left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id
					left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id
					left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id
					where encounter_type = enc_type_id and encounter.voided = 0 
					and encounter.encounter_datetime between datefrom and dateto
					INTO enc_n;
                
                else
                
					SELECT count(*) from encounter 
					left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id
					left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id
					left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id
					left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id
					where encounter_type = enc_type_id and encounter.voided = 0 
					and hydramodule_workflow.name = workflow and encounter.encounter_datetime between datefrom and dateto
					INTO enc_n;
                
                end if;
		        
				SET enc_i=0;
				WHILE enc_i &lt; enc_n DO 
				    
                    if workflow = ''  then
                    
						SELECT encounter.encounter_id into eid from encounter
						left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id 
						left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id 
						left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id 
						left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id 
						where encounter_type = enc_type_id and encounter.voided = 0
						and encounter.encounter_datetime between datefrom and dateto
						LIMIT enc_i, 1;
                    
                    else
                    
						SELECT encounter.encounter_id into eid from encounter
						left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id 
						left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id 
						left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id 
						left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id 
						where encounter_type = enc_type_id and encounter.voided = 0
						and hydramodule_workflow.name =  workflow and encounter.encounter_datetime between datefrom and dateto
						LIMIT enc_i, 1;
                    
                    end if;
		            
					/** Get encounter metadata info and insert into de-encountrised table **/
					SET @insert_query:=CONCAT('INSERT INTO ',tab_name,' (patient_id,patient_identifier, location_id, encounter_id, encounter_datetime, date_created, creator, provider_id, workflow) ',
												'SELECT encounter.patient_id, identifier, encounter.location_id, encounter.encounter_id, encounter.encounter_datetime, encounter.date_created, ',
												'encounter.creator, encounter_provider.provider_id, hydramodule_workflow.name from encounter ', 
												'left join encounter_provider on encounter.encounter_id = encounter_provider.encounter_id ',
												'left join patient_identifier on encounter.patient_id = patient_identifier.patient_id and identifier_type = 3 ',
                                                'left join hydra.hydramodule_form_encounter on hydramodule_form_encounter.encounter_id = encounter.encounter_id ',
												'left join hydra.hydramodule_component_form  on hydramodule_component_form.component_form_id = hydramodule_form_encounter.component_form_id ',
												'left join hydra.hydramodule_workflow on hydramodule_workflow.workflow_id = hydramodule_component_form.workflow_id ',
												'where encounter.encounter_id = ', eid);
		            PREPARE stmt from @insert_query;
					EXECUTE stmt;
			
					/** For all the obs of the specific encounter **/
					SELECT count(*) from obs where encounter_id = eid and voided = 0 into obs_n;
					SET obs_i=0;
					
                    WHILE obs_i &lt; obs_n DO 
						
						/** Get concept_id (question) and answers from value columns **/
						SELECT concept_id, value_numeric, value_coded, value_text, value_datetime into c_id, v_numeric, v_coded, v_text, v_datetime from obs where encounter_id = eid and voided = 0 LIMIT obs_i,1;
						/** generate column name **/
						SELECT alphanum(LOWER(name)) FROM concept_name where concept_id = c_id and concept_name_type = 'SHORT' limit 1 into concept_name;
			
						/** Check if concept column already exists in the de-encountrised table **/
						SET colName = NULL;
						SELECT column_name INTO colName
						FROM information_schema.columns 
						WHERE table_schema = 'hydra'
							AND table_name = tab_name
						AND column_name = concept_name;
									
						/** Get question datatype **/            
						SELECT concept_datatype.name into datatype from concept 
						join concept_datatype on concept.datatype_id = concept_datatype.concept_datatype_id
						where concept_id = c_id;
															
						/** alter to add column to de-encounterised table  and insert data according to datatype **/
						CASE datatype
							
							WHEN 'Coded' THEN 
                            
                                IF v_coded is not null then
					
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' text');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
													
								/** Get concept name for the coded_value **/
								SELECT name FROM concept_name where concept_id = v_coded and concept_name_type = 'FULLY_SPECIFIED' limit 1 into concept_answer;
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = IF(',concept_name,' is NULL,''', concept_answer, ''', CONCAT(' , concept_name,  ', '', '' ''', concept_answer,''')) WHERE encounter_id = ' , eid);
                                PREPARE stmt from @insert_value;
								EXECUTE stmt;
                                
                                end if;
                                
                            WHEN 'Numeric' THEN
							
								IF v_numeric is not null then
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' double');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
								                                
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = ',  v_numeric ,' WHERE encounter_id = ' , eid);
								PREPARE stmt from @insert_value;
								EXECUTE stmt; 
                                end if;
														
                            WHEN 'Text' THEN 
								
                                IF v_text is not null then
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' text');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
							
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = IF(',concept_name,' is NULL,''', v_text, ''', CONCAT(' , concept_name,  ', '', '' ''', v_text,''')) WHERE encounter_id = ' , eid);
								PREPARE stmt from @insert_value;
								EXECUTE stmt;
								END IF;
                                
							WHEN 'Date' || 'Time' || 'Datetime' THEN 
							
								IF v_datetime is not null then
								IF colName is null THEN 
									SET @alter_query:=CONCAT('ALTER TABLE ',tab_name,' ADD ', concept_name , ' datetime');
									PREPARE stmt from @alter_query;
									EXECUTE stmt;
								END IF;
							
								SET @insert_value:=CONCAT('update ',tab_name,' set ', concept_name,' = ''',  v_datetime ,''' WHERE encounter_id = ' , eid);
								PREPARE stmt from @insert_value;
								EXECUTE stmt;
                                end if;
								
						END CASE;
									
						SET obs_i = obs_i + 1;
					END WHILE;
							
					SET enc_i = enc_i + 1;
				END WHILE;
			
				SET i = i + 1;
			END WHILE;
			
		END;
	    
	    </createProcedure>
	</changeSet>
		<changeSet author="hareem.ajaz" id="hydra-202004271343">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="hydramodule_field"
					columnName="is_default" />
			</not>
		</preConditions>
		<comment>
			Adding column 'is_default' in hydramodule_field
			table
		</comment>
		<addColumn tableName="hydramodule_field">
			<column name="is_default" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
	
	
</databaseChangeLog>
